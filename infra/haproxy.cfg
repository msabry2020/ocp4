# Global settings
#---------------------------------------------------------------------
global
maxconn 20000
log /dev/log local0 info
chroot /var/lib/haproxy
pidfile /var/run/haproxy.pid
user haproxy
group haproxy
daemon
# turn on stats unix socket
stats socket /var/lib/haproxy/stats
#---------------------------------------------------------------------
# common defaults that all the 'listen' and 'backend' sections will
# use if not designated in their block
#---------------------------------------------------------------------
defaults
mode http
log global
option httplog
option dontlognull
option forwardfor except 127.0.0.0/8
option redispatch
retries 3
timeout http-request 10s
timeout queue 1m
timeout connect 10s
timeout client 300s
timeout server 300s
timeout http-keep-alive 10s
timeout check 10s
maxconn 20000

listen stats
bind :9000
mode http
stats enable
stats uri /

frontend openshift-app-https
bind *:443
default_backend openshift-app-https
mode tcp
option tcplog

backend openshift-app-https
balance roundrobin
# balance source
mode tcp
  server worker1 WORKER1_IP:443 check
  server worker2 WORKER2_IP:443 check
  server worker3 WORKER3_IP:443 check

frontend openshift-app-http
bind *:80
default_backend openshift-app-http
mode tcp
option tcplog
backend openshift-app-http
balance roundrobin
mode tcp
  server worker1 WORKER1_IP:80 check
  server worker2 WORKER2_IP:80 check
  server worker3 WORKER3_IP:80 check

frontend control-api
bind *:6443
default_backend control-api-be
mode tcp
option tcplog

backend control-api-be
balance roundrobin
mode tcp
  server bootstrap BOOTSTRAP_IP:6443 check 
  server control1 CONTROL1_IP:6443 check
  server control2 CONTROL2_IP:6443 check
  server control3 CONTROL3_IP:6443 check

frontend control-api-2
bind *:22623
default_backend control-api-2-be
mode tcp
option tcplog

backend control-api-2-be
balance roundrobin
mode tcp
  server bootstrap BOOTSTRAP_IP:22623 check 
  server control1 CONTROL1_IP:22623 check
  server control2 CONTROL2_IP:22623 check
  server control3 CONTROL3_IP:22623 check
